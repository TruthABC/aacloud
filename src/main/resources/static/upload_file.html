<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>aacloud upload file</title>
</head>
<script src="jquery.min.js"></script>
<body>
<div>
    <input id="fileToUpload" type ="file"/>
    <button onclick="doUploadFile()">Upload</button>
</div>
<script>
    function doUploadFile() {

        //confirm user selecting a file
        var files = document.getElementById("fileToUpload").files;
        if (files === undefined || files.length <= 0) {
            alert("No file selected");
            return;
        }

        //init for ajax file upload
        var file = files[0];
        var id = getUrlParam("id");
        var relativePath = getUrlParam("relativePath");
        var url = "upload?"+"id=" + id + "&relativePath=" + relativePath;
        var formData = new FormData();
        formData.append('file',file);

        $.ajax({
            url: url,  //Server script to process data
            type: "POST",
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function(data){
                var ret = JSON.parse(data);
                if (ret.errcode === 0) {
                    alert("upload successful");
                } else {
                    alert("upload failed: "+data.errmsg);
                }

            },
            error:function(e) {
                alert("upload failed");
            }
        });
    }

    /**
     * function to get url parameters
     * @param name
     * @returns {null}
     */
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);  //match parameter name
        if (r != null) return unescape(r[2]); return null;
    }
</script>
</body>
</html>